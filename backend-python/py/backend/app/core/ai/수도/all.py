import random

def 한판_진행(ai, 벡터db_맵):
    #  1. 먼저 시작은 랜덤으로 변수를 발생시킨다
    items = ["A", "B", "C", "D"]
    x = random.choice(items)

    #  2. 랜덤으로 발생시킨 변수에 따라서
    #       ai에게 다른 벡터db를 줘서 자연어를 받는다

    자연어 = ""

    if x == "A":
        # 금전피해 시나리오 줌
        자연어 = ai.응답(벡터db_맵["A"])
    elif x == "B":
        # 개인정보 유출 시나리오 줌
        자연어 = ai.응답(벡터db_맵["B"])
    elif x == "C":
        # 악성링크 설치 시나리오 줌
        자연어 = ai.응답(벡터db_맵["C"])
    elif x == "D":
        # 정상적인 유저 시나리오 줌
        자연어 = ai.응답(벡터db_맵["D"])

    # (게임 진행상 플레이어가 봐야 하므로 출력)
    print("AI(상황 제시):", 자연어)

    #  3. 플레이어는 그걸 보고 답변을 한다
    플레이어_답변 = input("플레이어의 답변: ")

    #  4. ai는 그 답변과 아까 자연어
    # 그리고 랜덤변수를 비교하여 답변이 잘되었는지 체크한다
    # ex A라면 금전피해 시나리오일거고
    # 첫 ai는 돈을 찾는듯한 자연어를 줫을거고
    # 사용자는 거기에 금전피해 발생시 가이드라인을 잘 설명했는지를 판단
    평가결과 = ai.평가(
        시나리오=x,
        상황_자연어=자연어,
        플레이어_답변=플레이어_답변
    )

    # 라운드 결과를 모아서 반환(리플레이/로그/점수화에 유리)
    return {
        "시나리오": x,
        "자연어": 자연어,
        "플레이어_답변": 플레이어_답변,
        "평가결과": 평가결과,
    }
